generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Modelo de Usuário
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String   // Senha hash
  creci     String?  // Campo CRECI opcional

  // SQLite não suporta Enum, então usamos String.
  // Valores esperados: "ADMIN" ou "FUNCIONARIO"
  role      String   @default("FUNCIONARIO")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relação: Imóveis cadastrados por este usuário
  properties    Property[]

  // Relação: Leads (Mensagens) atribuídos a este usuário
  assignedLeads Lead[]     @relation("AssignedLeads")

  // Relação: Visitas atribuídas a este usuário (NOVO)
  assignedVisits Visit[]   @relation("AssignedVisits")

  @@map("users")
}

// Modelo de Imóvel
model Property {
  id          String   @id @default(cuid())
  
  titulo      String
  descricao   String
  tipo        String
  
  // Alterado para Float para facilitar compatibilidade com JS
  preco       Float    
  
  cidade      String
  bairro      String
  endereco    String?
  
  quarto      Int      @default(0)
  banheiro    Int      @default(0)
  garagem     Int      @default(0)
  area        Float
  
  // Salva lista de URLs separadas por ponto e vírgula
  fotos       String?  @default("") 
  
  // Valores esperados: "PENDENTE", "DISPONIVEL", "VENDIDO", "RESERVADO"
  status      String   @default("PENDENTE")
  destaque    Boolean  @default(false)

  // NOVOS CAMPOS PARA O MAPA
  latitude    Float?
  longitude   Float?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  corretorId  String
  corretor    User     @relation(fields: [corretorId], references: [id])

  // Relação inversa para as visitas (Imóvel tem várias visitas)
  visits      Visit[]

  @@map("properties")
}

// Modelo de Leads (Contatos gerais do Site via formulário Fale Conosco)
model Lead {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String
  createdAt DateTime @default(now())
  
  // Status do atendimento (Novo, Em Andamento, Finalizado)
  status    String   @default("NOVO") 

  // Campo para dizer quem é o corretor dono desse lead
  assignedToId  String?
  assignedTo    User?   @relation("AssignedLeads", fields: [assignedToId], references: [id])

  @@map("leads")
}

// Modelo de Agendamento de Visitas
model Visit {
  id          String   @id @default(cuid())
  date        DateTime // Data da visita
  timeOfDay   String   // "MANHA" ou "TARDE"
  name        String
  email       String
  phone       String?
  
  status      String   @default("PENDENTE") // PENDENTE, CONFIRMADA, CANCELADA

  createdAt   DateTime @default(now())
  
  property    Property @relation(fields: [propertyId], references: [id])
  propertyId  String

  // Quem é o corretor responsável por essa visita?
  assignedToId  String?
  assignedTo    User?   @relation("AssignedVisits", fields: [assignedToId], references: [id])

  @@map("visits")
}