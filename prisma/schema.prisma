generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Modelo de Usuário
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String   // Senha hash
  creci     String?  // Campo CRECI opcional

  // Valores esperados: "ADMIN", "FUNCIONARIO", "BROKER", "CORRETOR"
  role      String   @default("FUNCIONARIO")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relações
  properties    Property[]
  assignedLeads Lead[]     @relation("AssignedLeads")
  assignedVisits Visit[]   @relation("AssignedVisits")

  // Índices para buscas rápidas de equipe
  @@index([email])
  @@index([role])
  @@map("users")
}

// Modelo de Imóvel
model Property {
  id          String   @id @default(cuid())
  
  // DADOS BÁSICOS
  titulo      String
  sobreTitulo String?  @default("") 
  descricao   String
  tipo        String   // Casa, Apt, etc.
  
  // FINALIDADE
  finalidade  String   @default("Venda") // "Venda", "Locação" ou "Venda e Locação" (controlado via app)

  // PREÇOS E CONDIÇÕES
  preco             Float    
  precoLocacao      Float?   @default(0) // NOVO: Para casos de Venda + Locação
  tipoValor         String?  @default("Preço fixo") 
  periodoPagamento  String?  // "Mensal", "Anual" (Para locação)
  depositoSeguranca Float?   @default(0) 
  
  valorCondominio         Float?   @default(0)
  periodicidadeCondominio String?  // "Mensal", "Anual"

  // DETALHES FÍSICOS
  area        Float    // Área Útil
  areaTerreno Float?   @default(0) 
  
  quarto      Int      @default(0)
  suites      Int      @default(0)
  banheiro    Int      @default(0)
  
  // VAGAS
  garagem          Int      @default(0) // Total
  vagasCobertas    Int      @default(0) 
  vagasDescobertas Int      @default(0) 
  vagasSubsolo     Boolean  @default(false)

  // DETALHES DE MERCADO
  statusMercado   String?
  anoConstrucao   Int?     
  condicaoImovel  String?
  tipoContrato    String?  @default("Sem Exclusividade")

  // LOCALIZAÇÃO
  cidade      String
  bairro      String
  endereco    String?
  latitude    Float?
  longitude   Float?

  // MIDIA E EXTRAS
  fotos           String?  @default("") 
  features        String?  @default("") 
  
  // SISTEMA E PRIVACIDADE
  status          String   @default("PENDENTE") // PENDENTE, DISPONIVEL, VENDIDO, RESERVADO
  destaque        Boolean  @default(false)
  displayAddress  Boolean  @default(true) 
  displayDetails  Boolean  @default(true) 

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  corretorId  String
  corretor    User     @relation(fields: [corretorId], references: [id])
  visits      Visit[]
  leads       Lead[]

  // OTIMIZAÇÃO: Índices para tornar as buscas e filtros do site instantâneos
  @@index([status])           // Filtro principal (só mostrar disponíveis)
  @@index([cidade, bairro])   // Busca por localização
  @@index([preco])            // Filtro por faixa de preço
  @@index([finalidade])       // Venda vs Locação
  @@index([tipo])             // Casa vs Apartamento
  @@index([destaque])         // Carregar destaques rápido
  @@index([corretorId])       // Listar imóveis de um corretor
  
  @@map("properties")
}

// Modelo de Leads
model Lead {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String
  createdAt DateTime @default(now())
  
  status    String   @default("NOVO") 

  assignedToId  String?
  assignedTo    User?   @relation("AssignedLeads", fields: [assignedToId], references: [id])

  propertyId    String?
  property      Property? @relation(fields: [propertyId], references: [id])

  // Otimização para painel de controle (Kanban)
  @@index([status])
  @@index([assignedToId])
  @@index([createdAt])

  @@map("leads")
}

// Modelo de Visitas
model Visit {
  id          String   @id @default(cuid())
  date        DateTime // Data da visita
  timeOfDay   String   // "MANHA" ou "TARDE"
  name        String
  email       String
  phone       String?
  status      String   @default("PENDENTE")

  createdAt   DateTime @default(now())
  
  property    Property @relation(fields: [propertyId], references: [id])
  propertyId  String

  assignedToId  String?
  assignedTo    User?   @relation("AssignedVisits", fields: [assignedToId], references: [id])

  // Otimização para agenda
  @@index([date])
  @@index([status])
  @@index([assignedToId])

  @@map("visits")
}