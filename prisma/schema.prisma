generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Modelo de Usuário
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String   // Senha hash
  creci     String?  // Campo CRECI opcional

  // SQLite não suporta Enum, então usamos String.
  // Valores esperados: "ADMIN" ou "FUNCIONARIO"
  role      String   @default("FUNCIONARIO")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relação: Imóveis cadastrados por este usuário
  properties    Property[]

  // Relação: Leads (Mensagens) atribuídos a este usuário
  assignedLeads Lead[]     @relation("AssignedLeads")

  // Relação: Visitas atribuídas a este usuário
  assignedVisits Visit[]   @relation("AssignedVisits")

  @@map("users")
}

// Modelo de Imóvel
model Property {
  id          String   @id @default(cuid())
  
  // DADOS BÁSICOS
  titulo      String
  sobreTitulo String?  @default("") 
  descricao   String
  tipo        String   // Casa, Apt, etc.
  
  // FINALIDADE (NOVO)
  finalidade  String   @default("Venda") // "Venda" ou "Locação"

  // PREÇOS E CONDIÇÕES (NOVOS)
  preco             Float    
  tipoValor         String?  @default("Preço fixo") // "Aluguel mensal", "Consultar", "Negociável", etc.
  periodoPagamento  String?  // "Mensal", "Anual" (Para locação)
  depositoSeguranca Float?   @default(0) // (Para locação)
  
  valorCondominio         Float?   @default(0)
  periodicidadeCondominio String?  // "Mensal", "Anual"

  // DETALHES FÍSICOS (NOVOS E ATUALIZADOS)
  area        Float    // Área Útil / Construída
  areaTerreno Float?   @default(0) // Área do Terreno
  
  quarto      Int      @default(0) // Dormitórios
  suites      Int      @default(0) // NOVO: Suítes
  banheiro    Int      @default(0)
  
  // VAGAS DETALHADAS (NOVOS)
  garagem          Int      @default(0) // Total
  vagasCobertas    Int      @default(0) // NOVO
  vagasDescobertas Int      @default(0) // NOVO
  vagasSubsolo     Boolean  @default(false) // NOVO: Se as vagas são no subsolo

  // DETALHES DE MERCADO E CONSTRUÇÃO (NOVOS)
  statusMercado   String?  // "Ótimo preço", "Nova construção", etc.
  anoConstrucao   Int?     // Ano (ex: 2024)
  condicaoImovel  String?  // "Ótima", "Regular", etc.
  tipoContrato    String?  @default("Sem Exclusividade") // "Com Exclusividade" / "Sem Exclusividade"

  // LOCALIZAÇÃO
  cidade      String
  bairro      String
  endereco    String?
  latitude    Float?
  longitude   Float?

  // MIDIA E EXTRAS
  fotos           String?  @default("") 
  features        String?  @default("") // Checklist completo
  
  // SISTEMA E PRIVACIDADE
  status          String   @default("PENDENTE") // PENDENTE, DISPONIVEL, VENDIDO, RESERVADO
  destaque        Boolean  @default(false)
  displayAddress  Boolean  @default(true) // Se false, esconde o endereço exato
  displayDetails  Boolean  @default(true) // Se false, esconde detalhes específicos

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  corretorId  String
  corretor    User     @relation(fields: [corretorId], references: [id])
  visits      Visit[]
  leads       Lead[]

  @@map("properties")
}

// Modelo de Leads (Contatos gerais do Site via formulário Fale Conosco)
model Lead {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String
  createdAt DateTime @default(now())
  
  // Status do atendimento (Novo, Em Andamento, Finalizado)
  status    String   @default("NOVO") 

  // Campo para dizer quem é o corretor dono desse lead
  assignedToId  String?
  assignedTo    User?   @relation("AssignedLeads", fields: [assignedToId], references: [id])

  // Relação com Imóvel (Opcional) - Permite saber qual imóvel gerou esse contato
  propertyId    String?
  property      Property? @relation(fields: [propertyId], references: [id])

  @@map("leads")
}

// Modelo de Agendamento de Visitas
model Visit {
  id          String   @id @default(cuid())
  date        DateTime // Data da visita
  timeOfDay   String   // "MANHA" ou "TARDE"
  name        String
  email       String
  phone       String?
  status      String   @default("PENDENTE") // PENDENTE, CONFIRMADA, CANCELADA

  createdAt   DateTime @default(now())
  
  property    Property @relation(fields: [propertyId], references: [id])
  propertyId  String

  // Quem é o corretor responsável por essa visita?
  assignedToId  String?
  assignedTo    User?   @relation("AssignedVisits", fields: [assignedToId], references: [id])

  @@map("visits")
}